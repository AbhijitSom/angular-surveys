angular.module("mwFormViewer",["ngSanitize","ui.sortable","pascalprecht.translate"]);
angular.module("mwFormViewer").run(["$templateCache",function(e){e.put("mw-form-confirmation-page.html","<div class=mw-form-confirmation-page><div class=mw-confirmation-message ng-if=\"ctrl.submitStatus=='SUCCESS'\"><span ng-if=ctrl.confirmationMessage>{{ctrl.confirmationMessage}}</span> <span ng-if=!ctrl.confirmationMessage translate=mwForm.confirmationPage.defaultMessage>Twoja odpowiedź została zapisana</span></div><div class=mw-error-message ng-if=\"ctrl.submitStatus=='ERROR'\"><span translate=mwForm.confirmationPage.errorMessage>Bład. Twoja odpowiedź nie została zapisana.</span></div><div class=mw-pending-message ng-if=\"ctrl.submitStatus=='IN_PROGRESS'\"><span translate=mwForm.confirmationPage.pendingMessage>Zapisywanie odpowiedzi w trakcie.</span></div></div>"),e.put("mw-form-question.html",'<div class=mw-form-question><div class=mw-question-text>{{ctrl.question.text}} <span ng-if=ctrl.question.required>*</span></div><div class=mw-question-answers><div ng-if="ctrl.question.type==\'text\'"><input class=form-control type=text ng-model=ctrl.questionResponse.answer placeholder="{{\'mwForm.question.preview.text\'|translate}}" ng-required=ctrl.question.required></div><div ng-if="ctrl.question.type==\'textarea\'"><textarea msd-elastic class=form-control ng-model=ctrl.questionResponse.answer placeholder="{{\'mwForm.question.preview.textarea\'|translate}}" ng-required=ctrl.question.required></textarea></div><div ng-if="ctrl.question.type==\'radio\'"><div class=radio ng-repeat="answer in ctrl.question.offeredAnswers"><label><input type=radio ng-model=ctrl.questionResponse.selectedAnswer ng-value=answer.id name=answer-for-question-{{ctrl.question.id}} ng-change=ctrl.selectedAnswerChanged() ng-required="ctrl.question.required &&!ctrl.isOtherAnswer"> {{answer.value}}</label></div><div class=radio ng-if=ctrl.question.otherAnswer><label><input type=radio ng-model=ctrl.isOtherAnswer ng-value=true name=other-answer-for-question-{{ctrl.question.id}} ng-change=ctrl.otherAnswerRadioChanged()>Inna:</label> <span class=form-inline><input type=text name=other-answer-for-question-{{ctrl.question.id}} ng-model=ctrl.questionResponse.other class=form-control ng-disabled=!ctrl.isOtherAnswer ng-required=ctrl.isOtherAnswer></span></div></div><div ng-if="ctrl.question.type==\'checkbox\'"><div class=checkbox ng-repeat="answer in ::ctrl.question.offeredAnswers"><label><input type=checkbox name=answer-for-question-{{ctrl.question.id}} ng-checked="ctrl.questionResponse.selectedAnswers.indexOf(answer.id) != -1" ng-click=ctrl.toggleSelectedAnswer(answer)> {{::answer.value}}</label></div><div class=checkbox ng-if=ctrl.question.otherAnswer><label><input type=checkbox name=answer-for-question-{{ctrl.question.id}} ng-model=ctrl.isOtherAnswer ng-change=ctrl.otherAnswerCheckboxChanged()><span translate=mwForm.question.preview.otherAnswer>Inna</span>:</label> <span class=form-inline><input type=text ng-model=ctrl.questionResponse.other name=other-answer-for-question-{{ctrl.question.id}} class=form-control ng-disabled=!ctrl.isOtherAnswer ng-required=ctrl.isOtherAnswer></span></div><input type=hidden ng-model=ctrl.selectedAnswer ng-required></div><div ng-if="ctrl.question.type==\'grid\'"><div class=table-responsive><table class="table table-condensed table-striped" border=0 cellpadding=5 cellspacing=0><thead><tr><td></td><td ng-repeat="col in ::ctrl.question.grid.cols"><label>{{::col.label}}</label></td></tr></thead><tbody><tr ng-repeat="row in ::ctrl.question.grid.rows"><td>{{::row.label}}</td><td ng-repeat="col in ::ctrl.question.grid.cols"><input type=radio ng-model=ctrl.questionResponse[row.id] ng-value=col.id name=answer-for-question-{{row.id}} ng-required=ctrl.question.required></td></tr></tbody></table></div></div><div ng-if="ctrl.question.type==\'division\'" class=division-list ng-form=ctrl.divisionForm><div class=form-inline style="margin-bottom: 5px" ng-repeat="item in ctrl.question.divisionList"><div class=form-group><label>{{item.value}}</label> <input type=number class=form-control ng-model=ctrl.questionResponse[item.id] min=0 max={{ctrl.question.quantity}} required style="width: 80px" ng-change=ctrl.computeDivisionSum()> <span>{{::ctrl.question.unit}}</span></div></div><div class=form-inline style="margin-bottom: 5px"><div class=form-group><label translate=mwForm.question.division.assignedSumLabel>Przydzielono</label> <input type=number class="form-control strict-validation" ng-model=ctrl.divisionSum min={{ctrl.question.quantity}} max={{ctrl.question.quantity}} style="width: 80px" readonly> <span>{{ctrl.question.unit}} <span translate=mwForm.question.division.fromRequiredLabel>z wymaganych</span> <strong>{{ctrl.question.quantity}}</strong> {{ctrl.question.unit}} <i ng-show=ctrl.divisionForm.$valid class="fa fa-check" style=color:#008000;></i></span></div></div></div><mw-priority-list ng-if="ctrl.question.type==\'priority\'" question-response=ctrl.questionResponse question=ctrl.question></mw-priority-list></div></div>'),e.put("mw-form-viewer-content.html",'<div class=mw-form-viewer-content><h1 class=form-title>{{ctrl.formData.name}}</h1><div class=mw-title-page ng-if="!ctrl.currentPage && !ctrl.formSubmitted"><div class=mw-form-description>{{ctrl.formData.description}}</div><button type=button class="btn btn-default begin-response-button" ng-click=ctrl.beginResponse() translate=mwForm.buttons.begin>Rozpocznij</button></div><div class=mw-form-page ng-if=ctrl.currentPage><h2 class=mw-page-title ng-if="ctrl.currentPage.namedPage && ctrl.currentPage.name">{{ctrl.currentPage.name}}</h2><div class=mw-form-page-element-list><div class=mw-page-element ng-repeat="pageElement in ctrl.currentPage.elements" ng-switch=pageElement.type><mw-form-question ng-switch-when=question question=pageElement.question question-response=ctrl.responseData[pageElement.question.id] read-only=ctrl.readOnly on-response-changed=ctrl.onResponseChanged(pageElement)></mw-form-question><div class=image-element ng-switch-when=image><figure ng-class="\'align-\'+pageElement.image.align"><img ng-src={{pageElement.image.src}} ng-attr-alt=pageElement.image.caption><figcaption ng-if=pageElement.image.caption>{{pageElement.image.caption}}</figcaption></figure></div><div ng-switch-when=paragraph><p ng-bind-html=pageElement.paragraph.html></p></div></div></div></div><mw-form-confirmation-page ng-if=ctrl.formSubmitted confirmation-message=ctrl.formData.confirmationMessage submit-status=ctrl.submitStatus></mw-form-confirmation-page><div class=mw-form-action-list><button type=button ng-if=ctrl.buttons.prevPage.visible class="btn btn-default prev-page-button" ng-click=ctrl.goToPrevPage()><i class="fa fa-chevron-left"></i> <span translate=mwForm.buttons.back>Wstecz</span></button> <button type=button ng-disabled=ctrl.form.$invalid ng-if=ctrl.buttons.nextPage.visible class="btn btn-default next-page-button" ng-click=ctrl.goToNextPage()><span translate=mwForm.buttons.next>Dalej</span> <i class="fa fa-chevron-right"></i></button> <button type=submit ng-disabled=ctrl.form.$invalid ng-if=ctrl.buttons.submitForm.visible class="btn btn-default next-page-button" ng-click=ctrl.submitForm()><span translate=mwForm.buttons.submit>Submit</span></button></div></div>'),e.put("mw-form-viewer.html","<div class=mw-form-viewer><form ng-if=!ctrl.options.nestedForm name=ctrl.form role=form novalidate ng-include=\"'mw-form-viewer-content.html'\"></form><div ng-if=ctrl.options.nestedForm ng-form=ctrl.form ng-include=\"'mw-form-viewer-content.html'\"></div></div>"),e.put("mw-priority-list.html",'<div class=mw-priority-list><table><thead><tr><th translate=mwForm.question.priority.sorted>Sorted</th><th translate=mwForm.question.priority.available>Available</th></tr></thead><tbody><tr><td class=mw-ordered-items ui-sortable=ctrl.orderedConfig ng-model=ctrl.questionResponse.priorityList><div class=mw-item ng-repeat="item in ctrl.questionResponse.priorityList"><strong>{{$index+1}}.</strong> {{::ctrl.idToItem[item.id].value}}</div></td><td class=mw-available-items ui-sortable=ctrl.availableConfig ng-model=ctrl.availableItems><div class=mw-item ng-repeat="item in ctrl.availableItems">{{::ctrl.idToItem[item.id].value}}</div></td></tr></tbody></table><input type=hidden ng-model=ctrl.allItemsOrdered ng-required=ctrl.question.required></div>')}]);
angular.module("mwFormViewer").directive("mwPriorityList",function(){return{replace:!0,restrict:"AE",require:"^mwFormQuestion",scope:{question:"=",questionResponse:"=",readOnly:"=?",options:"=?"},templateUrl:"mw-priority-list.html",controllerAs:"ctrl",bindToController:!0,controller:function(){function e(e){if(e)for(var i=0;i<e.length;i++){var t=e[i];t.priority=i+1}}function i(e){e.sort(function(e,i){return e.priority-i.priority})}var t=this;t.questionResponse.priorityList||(t.questionResponse.priorityList=[]),t.idToItem={},i(t.questionResponse.priorityList),t.availableItems=[],t.question.priorityList.forEach(function(e){t.idToItem[e.id]=e;var i=t.questionResponse.priorityList.some(function(i){return e.id==i.id});i||t.availableItems.push({priority:null,id:e.id})}),t.allItemsOrdered=0==t.availableItems.length?!0:null;var r={placeholder:"beingDragged",tolerance:"pointer",items:"div",revert:100};t.orderedConfig=angular.extend({},r,{stop:function(i,r){e(t.questionResponse.priorityList)}}),t.availableConfig=angular.extend({},r,{connectWith:".mw-ordered-items",stop:function(i,r){e(t.questionResponse.priorityList),t.allItemsOrdered=0==t.availableItems.length?!0:null}})},link:function(e,i,t,r){e.ctrl}}});
angular.module("mwFormViewer").directive("mwFormViewer",function(){return{replace:!0,restrict:"AE",scope:{formData:"=",responseData:"=",readOnly:"=?",options:"=?",formStatus:"=?",onSubmit:"&",api:"=?"},templateUrl:"mw-form-viewer.html",controllerAs:"ctrl",bindToController:!0,controller:function(){function e(){t.formData.pages.sort(function(e,t){return e.number-t.number})}var t=this;t.defaultOptions={nestedForm:!1,autoStart:!1},t.options=angular.extend({},t.defaultOptions,t.options),t.submitStatus="NOT_SUBMITTED",t.formSubmitted=!1,e(),t.pageIdToPage={},t.formData.pages.forEach(function(e){t.pageIdToPage[e.id]=e}),t.buttons={prevPage:{visible:!1,disabled:!1},nextPage:{visible:!1,disabled:!1},submitForm:{visible:!1,disabled:!1}},t.submitForm=function(){t.formSubmitted=!0,t.submitStatus="IN_PROGRESS",t.setCurrentPage(null);var e=t.onSubmit();e.then(function(){t.submitStatus="SUCCESS"})["catch"](function(){t.submitStatus="ERROR"})},t.setCurrentPage=function(e){return t.currentPage=e,e?(t.setDefaultNextPage(),void t.clearResponsesForCurrentPage()):(t.buttons.submitForm.visible=!1,t.buttons.prevPage.visible=!1,void(t.buttons.nextPage.visible=!1))},t.setDefaultNextPage=function(){var e=t.formData.pages.indexOf(t.currentPage);if(t.currentPage.isFirst=0==e,t.currentPage.isLast=e==t.formData.pages.length-1,t.buttons.submitForm.visible=t.currentPage.isLast,t.buttons.prevPage.visible=!t.currentPage.isFirst,t.buttons.nextPage.visible=!t.currentPage.isLast,t.currentPage.isLast?t.nextPage=null:t.nextPage=t.formData.pages[e+1],t.currentPage.pageFlow){var a=!1;t.currentPage.pageFlow.formSubmit?(t.nextPage=null,a=!0):t.currentPage.pageFlow.page?(t.nextPage=t.pageIdToPage[t.currentPage.pageFlow.page.id],t.buttons.nextPage.visible=!0):t.currentPage.isLast&&(t.nextPage=null,a=!0),t.buttons.submitForm.visible=a,t.buttons.nextPage.visible=!a}},t.clearResponsesForCurrentPage=function(){t.currentPage.elements.forEach(function(e){var a=e.question;a&&!t.responseData[a.id]&&(t.responseData[a.id]={})})},t.beginResponse=function(){t.formData.pages.length>0&&t.setCurrentPage(t.formData.pages[0])},t.resetPages=function(){t.prevPages=[],t.currentPage=null,t.nextPage=null,t.formSubmitted=!1,t.options.autoStart&&t.beginResponse()},t.resetPages(),t.goToPrevPage=function(){var e=t.prevPages.pop();t.setCurrentPage(e),t.updateNextPageBasedOnAllAnswers()},t.goToNextPage=function(){t.prevPages.push(t.currentPage),t.updateNextPageBasedOnAllAnswers(),t.setCurrentPage(t.nextPage)},t.updateNextPageBasedOnAllAnswers=function(){t.currentPage.elements.forEach(function(e){t.updateNextPageBasedOnPageElementAnswers(e)}),t.buttons.submitForm.visible=!t.nextPage,t.buttons.nextPage.visible=!!t.nextPage},t.updateNextPageBasedOnPageElementAnswers=function(e){var a=e.question;a&&a.pageFlowModifier&&a.offeredAnswers.forEach(function(e){e.pageFlow&&t.responseData[a.id].selectedAnswer==e.id&&(e.pageFlow.formSubmit?t.nextPage=null:e.pageFlow.page&&(t.nextPage=t.pageIdToPage[e.pageFlow.page.id]))})},t.onResponseChanged=function(e){t.setDefaultNextPage(),t.updateNextPageBasedOnAllAnswers()},t.api&&(t.api.reset=function(){for(var e in t.responseData)t.responseData.hasOwnProperty(e)&&delete t.responseData[e];t.buttons.submitForm.visible=!1,t.buttons.prevPage.visible=!1,t.buttons.nextPage.visible=!1,t.resetPages()})},link:function(e,t,a){var n=e.ctrl;n.formStatus&&(n.formStatus.form=n.form)}}});
angular.module("mwFormViewer").factory("FormQuestionId",function(){var e=0;return{next:function(){return++e}}}).directive("mwFormQuestion",function(){return{replace:!0,restrict:"AE",require:"^mwFormViewer",scope:{question:"=",questionResponse:"=",readOnly:"=?",options:"=?",onResponseChanged:"&?"},templateUrl:"mw-form-question.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","FormQuestionId",function(e,s){var n=this;n.id=s.next(),"radio"==n.question.type?(n.questionResponse.selectedAnswer||(n.questionResponse.selectedAnswer=null),n.questionResponse.other&&(n.isOtherAnswer=!0)):"checkbox"==n.question.type?(n.questionResponse.selectedAnswers?n.selectedAnswer=!0:n.questionResponse.selectedAnswers=[],n.questionResponse.other&&(n.isOtherAnswer=!0)):"grid"==n.question.type||"division"==n.question.type&&(n.computeDivisionSum=function(){n.divisionSum=0,n.question.divisionList.forEach(function(e){0==n.questionResponse[e.id]||n.questionResponse[e.id]?n.divisionSum+=n.questionResponse[e.id]:(n.questionResponse[e.id]=null,n.divisionSum+=0)})},n.computeDivisionSum()),n.isAnswerSelected=!1,n.selectedAnswerChanged=function(){delete n.questionResponse.other,n.isOtherAnswer=!1,n.answerChanged()},n.otherAnswerRadioChanged=function(){n.isOtherAnswer&&(n.questionResponse.selectedAnswer=null),n.answerChanged()},n.otherAnswerCheckboxChanged=function(){n.isOtherAnswer||delete n.questionResponse.other,n.selectedAnswer=n.questionResponse.selectedAnswers.length>0||n.isOtherAnswer?!0:null,n.answerChanged()},n.toggleSelectedAnswer=function(e){-1===n.questionResponse.selectedAnswers.indexOf(e.id)?n.questionResponse.selectedAnswers.push(e.id):n.questionResponse.selectedAnswers.splice(n.questionResponse.selectedAnswers.indexOf(e.id),1),n.selectedAnswer=n.questionResponse.selectedAnswers.length>0||n.isOtherAnswer?!0:null,n.answerChanged()},n.answerChanged=function(){n.onResponseChanged&&n.onResponseChanged()}}],link:function(e,s,n,o){e.ctrl}}});
angular.module("mwFormViewer").directive("mwFormConfirmationPage",function(){return{replace:!0,restrict:"AE",require:"^mwFormViewer",scope:{submitStatus:"=",confirmationMessage:"=",readOnly:"=?"},templateUrl:"mw-form-confirmation-page.html",controllerAs:"ctrl",bindToController:!0,controller:function(){},link:function(r,e,o,t){r.ctrl}}});