angular.module("mwFormUtils",["mwFormUtils.responseUtils"]);
angular.module("mwFormUtils.responseUtils",[]).factory("mwFormResponseUtils",function(){var e={},t=["text","textarea","number","date","time","email","range","url"];return e.$getObjectByIdMap=function(e,t){var r={};return e?(e.forEach(function(e){var i=e;t&&(i=t(e)),r[e.id]=i}),r):r},e.$getOfferedAnswerByIdMap=function(t){return e.$getObjectByIdMap(t.offeredAnswers,function(e){return{id:e.id,value:e.value}})},e.$extractResponseForQuestionWithOfferedAnswers=function(t,r){var i=e.$getOfferedAnswerByIdMap(t),n={};return r.selectedAnswers?(n.selectedAnswers=[],r.selectedAnswers.forEach(function(e){n.selectedAnswers.push(i[e])})):r.selectedAnswer&&(n.selectedAnswer=i[r.selectedAnswer]),r.other&&(n.other=r.other),n},e.$extractResponseForPriorityQuestion=function(t,r){var i=[];if(!r.priorityList)return i;var n=e.$getObjectByIdMap(t.priorityList);return r.priorityList.forEach(function(e){var t=n[e.id];i.push({id:t.id,value:t.value,priority:e.priority})}),i},e.$extractResponseForDivisionQuestion=function(t,r){var i=[],n=e.$getObjectByIdMap(t.divisionList);return Object.getOwnPropertyNames(r).forEach(function(e){var t=r[e],s=n[e];s&&i.push({id:s.id,label:s.value,value:t})}),i},e.$extractResponseForGridQuestion=function(t,r){var i=[];if(!t.grid||!t.grid.rows)return i;var n=e.$getObjectByIdMap(t.grid.cols);return t.grid.rows.forEach(function(e){var t=r[e.id],s=null;t&&(s=n[t]);var o={row:{id:e.id,label:e.label},col:null};s&&(o.col={id:s.id,label:s.label}),i.push(o)}),i},e.extractResponse=function(r,i){return-1!==t.indexOf(r.type)?i.answer:"radio"==r.type||"checkbox"==r.type||"select"==r.type?e.$extractResponseForQuestionWithOfferedAnswers(r,i):"grid"==r.type?e.$extractResponseForGridQuestion(r,i):"priority"==r.type?e.$extractResponseForPriorityQuestion(r,i):"division"==r.type?e.$extractResponseForDivisionQuestion(r,i):null},e.mergeFormWithResponse=function(t,r){var i={};return angular.copy(t,i),i.pages.forEach(function(t){t.elements.forEach(function(t){var i=t.question;if(i){var n=r[i.id];n&&(i.response=e.extractResponse(i,n))}})}),i},e.getQuestionList=function(e,t){var r=[];return e.pages.forEach(function(e){e.elements.forEach(function(e){if(e.question){var i=e.question;t&&(i={},angular.copy(e.question,i)),r.push(i)}})}),r},e.getQuestionWithResponseList=function(t,r){var i=[];return e.getQuestionList(t,!0).forEach(function(t){var n=r[t.id];n?t.response=e.extractResponse(t,n):t.response=null,i.push(t)}),i},e.$$getHeader=function(e,t,r,i,n){var s="";return n&&((e||0===e)&&(s+=e+"."),(r||0===r)&&(s+=r+"."),s.length&&(s+=" ")),s+=t,i&&(s+=" ["+i+"]"),s},e.getResponseSheetHeaders=function(t,r){var i=["grid","priority","division"],n=[],s=0;return e.getQuestionList(t).forEach(function(t){s++;var o=1;if(-1===i.indexOf(t.type))n.push(e.$$getHeader(s,t.text,null,null,r));else if("grid"==t.type){if(!t.grid)return;t.grid.rows.forEach(function(i){n.push(e.$$getHeader(s,t.text,o,i.label,r)),o++})}else if("priority"==t.type){if(!t.priorityList)return;t.priorityList.forEach(function(i){n.push(e.$$getHeader(s,t.text,o,i.value,r)),o++})}else if("division"==t.type){if(!t.divisionList)return;t.divisionList.forEach(function(i){n.push(e.$$getHeader(s,t.text,o,i.value,r)),o++})}}),n},e.getResponseSheetRow=function(t,r){var i="; ",n=[];if(!r)return n;for(var s=e.getQuestionWithResponseList(t,r),o=["radio","checkbox","select","grid","priority","division"],u=0;u<s.length;u++){var a=s[u],c=a.response;if(-1!==o.indexOf(a.type)){if("radio"==a.type||"select"==a.type){if(!c){n.push("");continue}var p="";c.selectedAnswer&&(p=c.selectedAnswer.value),c.other&&(p&&(p+=i),p+=c.other),n.push(p)}else if("checkbox"==a.type){if(!c||!c.selectedAnswers){n.push("");continue}var p="";c.selectedAnswers.forEach(function(e){p&&(p+=i),p+=e.value}),c.other&&(p&&(p+=i),p+=c.other),n.push(p)}else if("grid"==a.type){if(!a.grid)continue;if(!c){a.grid.rows.forEach(function(){n.push("")});continue}c.forEach(function(e){n.push(e.col?e.col.label:"")})}else if("priority"==a.type){if(!a.priorityList)continue;var f=e.$getObjectByIdMap(c);a.priorityList.forEach(function(e){var t=f[e.id];t?n.push(t.priority):n.push("")})}else if("division"==a.type){if(!a.divisionList)continue;var d=e.$getObjectByIdMap(c);a.divisionList.forEach(function(e){var t=d[e.id];t?n.push(t.value):n.push("")})}}else n.push(c?c:"")}return n},e.getResponseSheetRows=function(t,r){return r.map(function(r){return e.getResponseSheetRow(t,r)})},e.getResponseSheet=function(t,r,i){var n=[],s=e.getResponseSheetHeaders(t,i);return n.push(s),r?(r instanceof Array?r.forEach(function(r){n.push(e.getResponseSheetRow(t,r))}):n.push(e.getResponseSheetRow(t,r)),n):n},e});